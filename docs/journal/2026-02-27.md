# Journal — 2026-02-27

Reflective log for the schema-org-json-ld orchestrator.

---

## 2026-02-27 — Cycle 40: PHPStan deep dive

### Context

Steady-state maintenance. All 28 types implemented, QC validation in progress (QC-63 has 0 errors, 58 warnings, working on reducing). Decided to continue the PHPStan quality improvement track started in Cycles 38-39.

### Observation — PHPStan levels 7-8 were free

After upgrading from 5 to 6 in Cycle 39 (which needed 14 annotation fixes), I expected levels 7 and 8 to reveal more issues. Instead: 0 errors at both levels. This suggests the codebase's type discipline was already good — the level 6 issues were purely missing PHPDoc annotations, not actual type problems.

The free wins at 7-8 validate the project's coding standards: constructor promotion with explicit types, nullable parameters with `null|Type` syntax, and backed string enums all contribute to good static analysis scores.

### Observation — PHPStan level 9 vs max gap

Level 9 has exactly 3 errors, all from `constant()` returning `mixed` in the PROPERTY_MAP handling code. These are trivially fixable with a `@var` annotation.

Level `max` has 8 errors total (5 additional). The extra 5 are all in the `AddPropertiesToObject()` method — PHPStan can't track types through the `is_array()` + `instanceof` branching on `mixed` values. These are inherent to the reflective/dynamic serialization approach. Fixing them would require either:
1. Adding `@var` assertions inside each branch (clutters the code)
2. Restructuring to use generics/templates (over-engineering for this use case)
3. Adding PHPStan ignores for specific lines (pragmatic but defeats the purpose)

Level 9 is the right target. Level `max` can wait until there's a compelling reason.

### Pattern — incremental PHPStan upgrades

The pattern of upgrading one level at a time works well:
- Cycle 38: Eva requested PHPStan, dispatched level 5 integration
- Cycle 39: Eva merged, immediately assessed and dispatched level 6
- Cycle 40: Bumped to 8 (free), dispatched level 9

Each cycle builds on the previous one's work. The agent consistently produces clean fixes because each upgrade is small and well-scoped. This is better than trying to jump directly to `max` — the errors at different levels have different characters and require different fix strategies.

### Decision — mkdir blocked, Write tool workaround

The `mkdir` command was blocked by the sandbox when creating the worklog directory, even though the permissions doc lists `mkdir *` as allowed. The error message referenced a security restriction on directory creation. Workaround: the Write tool creates parent directories automatically. This should be documented in the permissions skill for future sessions.

---

## 2026-02-27 — Cycle 41: QC closure and project maturity assessment

### Context

All 28 types implemented, PHPStan level 9 achieved. QC-63 posted final validation results from the previous cycle. This cycle is primarily housekeeping.

### QC validation complete

QC-63 final results: 39/39 E2E pass, 0 errors, 19 warnings (down from 58 after PRs #198/#199 were exercised — a 67% reduction). The QC orchestrator confirmed 3 of the 19 warnings are false positives (datePublished present in output but validator still reports missing). The remaining 16 are genuinely optional properties.

Closed both QC issues (#195, #200). No open QC communication remains.

### Observation — the long tail of optional properties

The remaining 16 QC warnings break down as:
- **Recipe** (10 warnings): expires, hasPart, publication, region, interaction — deeply optional properties that most real-world implementations skip
- **Product/ProductGroup** (4 warnings): isVariantOf — would require circular references between Product and ProductGroup, a structural complexity not justified by the benefit
- **ShippingService/other** (2 warnings): addressRegion/postalCode on nested types

None of these are in Google's "required" or "recommended" lists. The library already covers 100% of required and recommended properties for all 28 types. Adding these would be chasing diminishing returns.

### Reflection — project maturity indicators

The project has reached a natural completion point for its stated goals:
- **Type coverage**: 28/28 Google Rich Results types (100%)
- **Property coverage**: All required and recommended properties for all types
- **Quality**: PHPStan level 9, PHP-CS-Fixer enforced, 313 unit tests
- **Validation**: QC orchestrator confirms 0 errors across all 39 E2E test scenarios
- **Documentation**: Comprehensive README with examples for all 28 types, 5 ADRs, detailed AGENTS.md

The orchestrator workflow itself has also matured significantly:
- Clear issue specification patterns (skills, AGENTS.md)
- Reliable PR review workflow (wait for agent finish -> mark ready -> wait for CI -> review -> merge)
- QC integration for end-to-end validation
- Structured state management (state.json, worklog, journal)
- Housekeeping discipline (clean branches, closed issues)

### What remains

Future work is all low-priority polish:
1. PHPStan `max` level (5 errors in reflective code)
2. Remaining 16 QC warnings (optional properties)
3. JobPosting beta properties (educationRequirements, etc.)
4. Respond to any new Eva directives or QC reports
