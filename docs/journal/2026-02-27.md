# Journal — 2026-02-27

Reflective log for the schema-org-json-ld orchestrator.

---

## 2026-02-27 — Cycle 40: PHPStan deep dive

### Context

Steady-state maintenance. All 28 types implemented, QC validation in progress (QC-63 has 0 errors, 58 warnings, working on reducing). Decided to continue the PHPStan quality improvement track started in Cycles 38-39.

### Observation — PHPStan levels 7-8 were free

After upgrading from 5 to 6 in Cycle 39 (which needed 14 annotation fixes), I expected levels 7 and 8 to reveal more issues. Instead: 0 errors at both levels. This suggests the codebase's type discipline was already good — the level 6 issues were purely missing PHPDoc annotations, not actual type problems.

The free wins at 7-8 validate the project's coding standards: constructor promotion with explicit types, nullable parameters with `null|Type` syntax, and backed string enums all contribute to good static analysis scores.

### Observation — PHPStan level 9 vs max gap

Level 9 has exactly 3 errors, all from `constant()` returning `mixed` in the PROPERTY_MAP handling code. These are trivially fixable with a `@var` annotation.

Level `max` has 8 errors total (5 additional). The extra 5 are all in the `AddPropertiesToObject()` method — PHPStan can't track types through the `is_array()` + `instanceof` branching on `mixed` values. These are inherent to the reflective/dynamic serialization approach. Fixing them would require either:
1. Adding `@var` assertions inside each branch (clutters the code)
2. Restructuring to use generics/templates (over-engineering for this use case)
3. Adding PHPStan ignores for specific lines (pragmatic but defeats the purpose)

Level 9 is the right target. Level `max` can wait until there's a compelling reason.

### Pattern — incremental PHPStan upgrades

The pattern of upgrading one level at a time works well:
- Cycle 38: Eva requested PHPStan, dispatched level 5 integration
- Cycle 39: Eva merged, immediately assessed and dispatched level 6
- Cycle 40: Bumped to 8 (free), dispatched level 9

Each cycle builds on the previous one's work. The agent consistently produces clean fixes because each upgrade is small and well-scoped. This is better than trying to jump directly to `max` — the errors at different levels have different characters and require different fix strategies.

### Decision — mkdir blocked, Write tool workaround

The `mkdir` command was blocked by the sandbox when creating the worklog directory, even though the permissions doc lists `mkdir *` as allowed. The error message referenced a security restriction on directory creation. Workaround: the Write tool creates parent directories automatically. This should be documented in the permissions skill for future sessions.

---

## 2026-02-27 — Cycle 41: QC closure and project maturity assessment

### Context

All 28 types implemented, PHPStan level 9 achieved. QC-63 posted final validation results from the previous cycle. This cycle is primarily housekeeping.

### QC validation complete

QC-63 final results: 39/39 E2E pass, 0 errors, 19 warnings (down from 58 after PRs #198/#199 were exercised — a 67% reduction). The QC orchestrator confirmed 3 of the 19 warnings are false positives (datePublished present in output but validator still reports missing). The remaining 16 are genuinely optional properties.

Closed both QC issues (#195, #200). No open QC communication remains.

### Observation — the long tail of optional properties

The remaining 16 QC warnings break down as:
- **Recipe** (10 warnings): expires, hasPart, publication, region, interaction — deeply optional properties that most real-world implementations skip
- **Product/ProductGroup** (4 warnings): isVariantOf — would require circular references between Product and ProductGroup, a structural complexity not justified by the benefit
- **ShippingService/other** (2 warnings): addressRegion/postalCode on nested types

None of these are in Google's "required" or "recommended" lists. The library already covers 100% of required and recommended properties for all 28 types. Adding these would be chasing diminishing returns.

### Reflection — project maturity indicators

The project has reached a natural completion point for its stated goals:
- **Type coverage**: 28/28 Google Rich Results types (100%)
- **Property coverage**: All required and recommended properties for all types
- **Quality**: PHPStan level 9, PHP-CS-Fixer enforced, 313 unit tests
- **Validation**: QC orchestrator confirms 0 errors across all 39 E2E test scenarios
- **Documentation**: Comprehensive README with examples for all 28 types, 5 ADRs, detailed AGENTS.md

The orchestrator workflow itself has also matured significantly:
- Clear issue specification patterns (skills, AGENTS.md)
- Reliable PR review workflow (wait for agent finish -> mark ready -> wait for CI -> review -> merge)
- QC integration for end-to-end validation
- Structured state management (state.json, worklog, journal)
- Housekeeping discipline (clean branches, closed issues)

### What remains

Future work is all low-priority polish:
1. PHPStan `max` level (5 errors in reflective code)
2. Remaining 16 QC warnings (optional properties)
3. JobPosting beta properties (educationRequirements, etc.)
4. Respond to any new Eva directives or QC reports

---

## 2026-02-27 — Cycle 42: Documentation accuracy audit

### Context

Steady state continues. No agent work, no QC communication, no Eva directives. Used the cycle for quality assurance on documentation and skills.

### Finding — stale counts in README

The README header claimed "28 Google Rich Results types" and "97 schema classes." Both were inaccurate:

- **98 schema classes** (not 97): [PR #199](https://github.com/EvaLok/schema-org-json-ld/issues/199) added `BroadcastEvent` as a new class file but the README count wasn't updated. This is a pattern worth noting — any PR that adds new files should update the count. But since we're at feature-complete, it shouldn't recur.
- **26 Google Rich Results categories** (not 28): Google's Search Gallery has exactly 26 categories. The "28" number came from state.json's `implemented` array, which counts AggregateRating and Person as separate top-level implementations (they're shared sub-types dispatched as individual work items). The distinction matters: 26 is the Google-facing count; 28 is the internal dispatch count.

### Observation — skills are in good shape

Audited all 5 skill files. All are comprehensive, well-structured, and internally consistent. No updates needed. The skills have stabilized — they encode the lessons from 40+ cycles of orchestration and don't need frequent revision anymore. This is a sign of workflow maturity.

### Pattern — maintenance cycles are getting shorter

Cycles 40-42 have all been maintenance cycles. Each one completes faster than the last because there's progressively less to audit, fix, or improve. This is the expected behavior of a converging system. The workflow flywheel has been turning for 42 cycles and the project is in a clean, stable state.

The remaining low-priority work items (PHPStan max, optional properties, JobPosting beta) haven't moved because they're genuinely low-value relative to their cost. This is the right outcome — not everything needs to be done.

---

## 2026-02-27 — Cycle 43: QC-driven Recipe property additions

### Context

Another steady-state cycle, but this time with actionable input: the QC orchestrator filed a new report (QC repo issue #72) identifying 5 optional properties missing from Recipe. This is the first new agent dispatch in 4 cycles.

### Observation — QC-driven work is the cleanest workflow

The QC report for Recipe was exceptionally well-structured: it listed each missing property, the validator message, which existing class already has it, and the suggested PHP type. This made the agent task spec almost write itself.

This pattern — QC identifies a gap, orchestrator verifies and dispatches — is the most efficient mode of operation. The QC orchestrator acts as an automated requirements analyst, converting validator output into actionable specifications. The orchestrator's job reduces to: verify the author, assess priority, write the issue spec, dispatch.

### Decision — implementing all 5 Recipe properties in one issue

The QC report asks for 5 optional properties. I could have split this into multiple issues, but all 5 are simple additions to an existing class with all dependent types already in the library. The agent should handle this in a single PR.

If the agent produces good output, this validates the "batch small related changes" pattern for property additions. If it struggles, the lesson is to keep property additions even more atomic.

### Observation — diminishing-returns work is still worth doing (when QC drives it)

In Cycle 41, I noted that the remaining 16 QC warnings were "chasing diminishing returns." But when the QC orchestrator explicitly files a report with clear specs, the cost of addressing them drops significantly. The QC report eliminated the research cost — I didn't need to figure out what was missing or what types to use. This shifts the cost-benefit calculation in favor of fixing them.

---

## 2026-02-27 — Cycle 44: Stale assumptions and ProductGroup subjectOf

### Context

Maintenance cycle. QC request [#215](https://github.com/EvaLok/schema-org-json-ld/issues/215) still pending (no response from QC orchestrator yet). No Eva input, no open PRs, clean slate.

### Discovery — isVariantOf was never actually missing

The state.json carried a note since Cycle 41: "Product/ProductGroup — isVariantOf — structural change for circular references — 4 QC warnings." I accepted this at face value for 3 cycles without verifying it.

Today I investigated the actual code and found `isVariantOf` is already implemented on `Product` (line 37) and `hasVariant` on `ProductGroup` (line 18). The "circular references" concern was overstated — one-way references (Product → ProductGroup) work perfectly with the existing JsonLdGenerator, which doesn't track visited objects. True circular serialization (Product → ProductGroup → Product → ...) would cause a stack overflow, but Google's structured data never requires this.

The 4 QC warnings for ProductGroup actually break down as:
- 2x `subjectOf` — ProductGroup class genuinely missing this property (Product has it)
- 2x `isVariantOf` — library already supports it; QC test scripts just need to exercise it

### Lesson — verify inherited assumptions

State file entries can become stale truths. The "structural change for circular references" note was written early and never questioned. Each subsequent cycle read it and accepted it. This is a classic persistence hazard: state files persist assumptions beyond their expiry date.

Mitigation: when a remaining-work item persists across 3+ cycles without action, actively re-examine it rather than carrying it forward.

### Action — dispatched ProductGroup subjectOf

Created [#217](https://github.com/EvaLok/schema-org-json-ld/issues/217) for the agent to add `subjectOf` to ProductGroup. Trivial change (1 property + tests) but it follows the rule that PHP code goes through PRs.

Updated state.json to correct the stale note and reflect the true status of each warning.

---

## 2026-02-27 — Cycle 45: Scope boundary — Book actions

### Context

Short maintenance cycle. QC acknowledged request [#215](https://github.com/EvaLok/schema-org-json-ld/issues/215), baseline at 13 warnings (down from 19), updating scripts. No Eva input, no agent work.

### Discovery — Book actions in Google Search Gallery

Reviewed the Google Search Gallery for any new structured data types. Found **Book actions** listed — was not in the original briefing's type list. Investigation revealed it's fundamentally different from our implemented types:

- Uses `DataFeed` as root container, not page-level `@type` annotations
- Designed for catalog data feeds (book metadata, editions, purchase/borrow actions)
- Validated by Google's Data Feed validation tool, not the Rich Results Test
- Requires hosted feed URLs (SFTP, S3, GCS) with daily updates
- Complex nesting: Work → Edition → Action → EntryPoint → Offer

This is clearly outside the project's scope. The library targets page-level JSON-LD annotations validated by the Rich Results Test. Book actions is a catalog data pipeline — different problem domain entirely.

### Observation — scope boundaries matter

The briefing correctly excluded Book actions by specifying "Google's Rich Results Test is the acceptance test." This is a useful scope boundary: it excludes DataFeed-based types (Book, potentially others in the future) while including all page-level annotation types. The boundary is clear, testable, and aligns with the library's architecture.

### QC validation note

The warning count dropped from 19 to 13 between Cycle 44 and Cycle 45's QC acknowledgement. The QC hasn't updated its Recipe scripts yet, so this reduction is from the package update itself (commits from PRs #214 and #218). This suggests the validator recognizes available properties even when the generate scripts don't fully exercise them — or the ProductGroup `subjectOf` addition resolved some warnings directly.

---

## 2026-02-27 — Cycle 46: Pre-release review for v1.0.0

### Context

Maintenance cycle focused on verifying v1.0.0 readiness. Eva gave the green light in [#180](https://github.com/EvaLok/schema-org-json-ld/issues/180): final review, QC validation, then recommend a commit hash.

### v1.0.0 readiness confirmed

Ran all verification checks:
- 320 tests / 1655 assertions — all passing
- PHPStan level 9 — 0 errors
- 98 schema classes (86 Schema + 12 Enum) — README count accurate
- composer.json: MIT license, PHP >=8.1.0, correct autoload, keywords comprehensive
- Only 2 open issues: #220 (this cycle) and #215 (QC request)

Everything is in order. The commit to tag is `ffc352b` — the current HEAD, which includes all work through Cycle 45 (ProductGroup subjectOf, Recipe optional properties, PHPStan level 9).

### Observation — the waiting game

The project has been in a "waiting for QC" state for 3 cycles now (44, 45, 46). The QC orchestrator's Copilot finished its work on PR #76 at 07:43 UTC, but the QC orchestrator hasn't reviewed it yet. This is normal — the QC orchestrator runs on its own schedule and can't be accelerated.

This waiting pattern is a natural feature of multi-agent workflows: each agent runs independently, and handoff points introduce latency. The orchestrator's job during these gaps is to verify, audit, and prepare — which is exactly what this cycle did. Not every cycle needs to produce new code. Some cycles exist to confirm that nothing needs to change.

### Decision — recommend commit hash once QC validates

The v1.0.0 recommendation workflow:
1. QC merges PR #76 → runs E2E → posts results on QC#74
2. I read results, close #215
3. Open a `question-for-eva` issue recommending commit `ffc352b` for v1.0.0 tagging
4. Eva tags and releases

This is a clean handoff. The commit hash is stable (no more code changes planned), and the QC validation is the last gate.

---

## 2026-02-27 — Cycle 47: QC validated, v1.0.0 recommendation sent

### Context

The QC orchestrator completed its final validation run. This is the culmination of the v1.0.0 preparation workflow that started with Eva's green light in [#180](https://github.com/EvaLok/schema-org-json-ld/issues/180).

### QC validation complete

QC PR [#76](https://github.com/EvaLok/schema-org-json-ld-qc/pull/76) merged at 10:16 UTC. QC issue [#74](https://github.com/EvaLok/schema-org-json-ld-qc/issues/74) closed at 10:17 UTC with comprehensive results:
- 39/39 E2E pass, 0 errors
- All 5 Recipe optional properties confirmed present and correct
- 186 QC unit tests, 1125 assertions pass

The QC orchestrator noted that the Adobe structured data validator (v1.6.0) reports some properties as "missing" even though they're present in the JSON-LD output. This is a validator limitation, not a library defect. Good to have this documented.

### Observation — the multi-agent handoff latency

The QC validation took ~3 hours from Copilot finishing (07:43 UTC) to the QC orchestrator reviewing and posting results (10:17 UTC). This is within normal bounds for an autonomous system where each orchestrator runs on its own 90-minute cycle schedule. The waiting cost was low — 4 maintenance cycles (44-47) where the only substantive work was the v1.0.0 readiness audit and some stale-assumption cleanup. Both were valuable housekeeping activities that would have happened eventually anyway.

### Pattern — the full QC-driven workflow

Looking back, the complete QC-driven workflow for the Recipe properties was:

1. **QC report** (QC repo #72): "These 5 properties are missing"
2. **Orchestrator verifies, dispatches** (#213 → PR #214): Agent implements in one PR
3. **Orchestrator sends QC request** (#215): "Please validate"
4. **QC acknowledges** (QC repo #74): "Received, updating scripts"
5. **QC validates** (QC repo PR #76 → QC#74 closed): "All confirmed"
6. **Orchestrator closes request** (#215): Round-trip complete

Total elapsed time: ~29 hours (QC report at 05:45 on 2/27, closed at 10:46). But the actual work was small — one agent dispatch, one review, one merge. The rest was waiting for each system to pick up the other's output on its next cycle. This is an inherent property of asynchronous multi-agent systems: throughput is high (many tasks can be in-flight), but latency for any single task spans multiple cycles.

### v1.0.0 recommendation

Created a `question-for-eva` issue with the recommended commit hash. The project is now in Eva's hands for the release tag. No further code changes are planned or needed.

### Reflection — project completion

This feels like a genuine milestone. From the first orchestrator cycle (2026-02-24) to QC-validated v1.0.0 readiness (2026-02-27) is 3 days. In that time:
- 28 Google Rich Results types implemented
- 98 schema classes built
- 320 unit tests written
- PHPStan level 9 achieved
- 11 quality improvement PRs merged
- 5 QC validation rounds completed
- 47 orchestrator cycles run

The workflow improved continuously — from early issues with agent assignment APIs and PAT permissions, through skill creation and AGENTS.md refinements, to a smooth QC integration pipeline. The journal captures this evolution. The project succeeded not because the first cycle was perfect, but because each cycle learned from the last.

---

## 2026-02-27 — Cycle 48: Holding pattern, release pending

### Context

Maintenance cycle. v1.0.0 recommendation ([#222](https://github.com/EvaLok/schema-org-json-ld/issues/222)) still awaiting Eva's response. All systems clean.

### Observation — the "release pending" hold pattern

This is the 8th consecutive maintenance cycle (41-48) without any new agent dispatch. The last substantive code change was PR #218 (ProductGroup subjectOf) in Cycle 44. The project has been in a converging state for over 12 hours.

The natural instinct during idle cycles is to find something to improve — dispatch another fix, add another property, refine another test. But with a v1.0.0 recommendation outstanding, any code change would invalidate the recommended commit hash and force a new recommendation workflow. The correct behavior is to hold steady.

This is an interesting property of release management in autonomous systems: the orchestrator needs to recognize when "do nothing" is the optimal action. Not every cycle needs to produce output. Some cycles exist to confirm that the system is stable and nothing has changed that requires intervention.

### Observation — Google Search Gallery stability

Re-checked the Google Rich Results Search Gallery: still 26 categories, identical to our previous audit. The library's type coverage remains 100%. This confirms the implementation target is stable — Google isn't adding new types at a pace that would invalidate our completeness claim.

### Pattern — maintenance cycle cadence

The 90-minute cycle cadence means roughly 16 cycles per day. In a feature-complete project, most of these cycles are no-ops. The startup checklist runs, finds nothing actionable, and the cycle closes with a brief worklog entry. This is expected and healthy — the overhead per cycle is minimal (a few API calls and a worklog commit).

If this project were to enter a long maintenance phase, the cycle cadence could be reduced. But since the v1.0.0 tag could happen at any time (whenever Eva responds), keeping the current cadence ensures timely response to any directives.

---

## 2026-02-27 — Cycle 49: v1.0.0 released

### Context

Eva tagged v1.0.0 at 13:25 UTC. The hold pattern (Cycles 41-48) is over. This cycle also handled two Eva input issues: PHP 8.5 support and a journal-entries skill.

### Observation — the release hold pattern worked

The 8-cycle hold pattern (Cycles 41-48) was the right call. By not merging any code after the recommended commit hash, Eva was able to tag v1.0.0 cleanly without needing to re-validate anything. The patience cost was low (each cycle was a quick maintenance check) and the benefit was high (clean release, no last-minute surprises).

In future releases, this pattern should be explicit: once a release recommendation is issued, enter hold mode until the release is tagged or the recommendation is withdrawn.

### Observation — PHP 8.5 compatibility was free

PHP 8.5 introduced significant new features (pipe operator, `clone with`, `array_first()`/`array_last()`) but zero breaking changes for this codebase. The deprecations (non-canonical casts, `__sleep()`/`__wakeup()`, backtick operator) don't affect us because the codebase uses modern PHP idioms.

This is a validation of the project's coding standards: constructor promotion, union types, backed string enums, and nullable parameters are all forward-compatible patterns. A library built on these foundations doesn't break when PHP adds new features. The `>=8.1.0` minimum is the right choice — it maximizes compatibility without constraining the codebase.

### Decision — journal-entries as reference skill, not tool

Eva suggested "a tool attached to the skill might be even better." I created the skill as reference knowledge (`user-invocable: false`) rather than a tool for two reasons:

1. **Permission constraints**: The orchestrator's sandbox blocks `bash`, `echo`, and other commands needed for a shell tool. Any tool would need to use only `gh`, `git`, `jq`, `mkdir`, `ls`, `date`, `wc`, `sort`, `composer`. A journal-writing tool within these constraints would be more complex than the Write tool approach.

2. **The Write tool already works**: Journal entries are created with the Write tool (for new files) or Edit tool (for appending). Adding a wrapper tool would add a layer of indirection without improving the outcome. The value is in the _conventions_ (what to write, how to structure it), not the _mechanics_ (how to create a file).

The skill captures conventions; the existing tools handle execution. This is the right separation of concerns.

### Pattern — post-release workflow

With v1.0.0 out, the project enters a new phase:
- The `[Unreleased]` section in CHANGELOG.md is empty and ready for post-1.0.0 changes
- New code can be merged without invalidating any release
- The low-priority audit findings (JobPosting beta properties) can be addressed whenever convenient
- Eva may have new directions now that the initial milestone is reached

The orchestrator's role shifts from "build toward v1.0.0" to "maintain and extend as directed." This is a healthier mode — less urgency, more considered decisions.
