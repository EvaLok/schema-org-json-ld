# Journal — 2026-02-25

Reflective log for the schema-org-json-ld orchestrator.

---

## 2026-02-25 — Ninth Cycle

**Context**: Ninth cycle. Clean slate. No Eva input. Research and implement all remaining feasible types.

### Near-complete Google Rich Results coverage achieved

This cycle implemented the last 4 feasible Google Rich Results types: Speakable, Carousel, Subscription/Paywalled Content, and Vacation Rental. The library now covers 27 of 28 types (96%). The only remaining type is Math Solver, which requires changes to the core `JsonLdGenerator` — a design decision deferred to Eva via question [#78](https://github.com/EvaLok/schema-org-json-ld/issues/78).

### Research before dispatch pays off

Spending time at the start of the cycle to thoroughly research all 5 remaining types was valuable:
- Speakable turned out to be trivially simple (as suspected)
- Carousel's ListItem modification worked cleanly because the existing `JsonLdGenerator` already handles `string|TypedSchema` union types
- Subscription/Paywalled Content was simpler than expected — just a thin WebPageElement + two Article properties
- Vacation Rental was the most complex but well within the agent's demonstrated capabilities
- Math Solver genuinely requires generator changes — confirmed by research, not assumed

This upfront research eliminated false starts and allowed optimal batching (no file conflicts between concurrent tasks).

### Batching by file conflicts is effective

The key insight this cycle: plan batches around file conflicts, not just complexity.
- Batch 1: Speakable (modifies Article) + Carousel (modifies ListItem) — no overlap
- Batch 2: Subscription (modifies Article) + Vacation Rental (new files only) — no overlap
- Speakable had to merge before Subscription could dispatch, since both modify Article

This constraint-based batching ensures zero merge conflicts without serializing everything.

### Zero-revision streak: 19 consecutive clean PRs

The streak now spans 5 cycles (Cycles 5-9). The combination of:
1. Comprehensive AGENTS.md with explicit style rules
2. cs-fix as a mandatory step
3. Well-researched issue specs with expected JSON-LD output

...produces consistent first-attempt success. The agent guidance infrastructure is mature.

### Math Solver is the first type that needs generator changes

Every previous type (27 of them) fit cleanly into the `TypedSchema` + `JsonLdGenerator` pattern. Math Solver is the first to require:
1. Array `@type` (`["MathSolver", "LearningResource"]`)
2. Hyphenated property names (`mathExpression-input`)

These are legitimate schema.org features used by other types beyond Math Solver. Supporting them would make the library more generally useful, but it's a core infrastructure change that should be Eva's call.

### Vacation Rental is the deepest nesting so far

VacationRental → Accommodation → BedDetails[]/LocationFeatureSpecification[]/QuantitativeValue — 4 levels of nesting. The agent handled it cleanly, and the JsonLdGenerator's recursive serialization worked correctly. This validates the architecture for even complex types.

### Agent timing: consistently 7-10 minutes

| Batch 1 | Batch 2 |
|---------|---------|
| Speakable: ~7 min | Subscription: ~8 min |
| Carousel: ~8 min | Vacation Rental: ~10 min |

All within the established 7-10 minute window. The Vacation Rental (4 new types, most complex) was at the upper end but not an outlier like LocalBusiness and Recipe in Cycle 5.

### Open questions

- What should the orchestrator focus on now that type implementation is essentially complete?
- Should we invest in README/documentation, integration tests, or new features?
- Will Eva want Math Solver implemented or not? The design decision is non-blocking for everything else.

---

## 2026-02-25 — Tenth Cycle

**Context**: Tenth cycle. Clean slate. No Eva input. Eva has not responded to [#78](https://github.com/EvaLok/schema-org-json-ld/issues/78) (Math Solver). Focus shifts from type implementation to quality improvement.

### Shift to quality improvement mode

With 27/28 types implemented and Math Solver blocked on Eva's decision, this cycle marks a transition from feature work to quality work. The audit at cycle start revealed:

1. **README severely outdated** — still says "only supports Product and Offer" despite 27 types and 65 schema classes being implemented. This is the most user-visible quality issue.
2. **21 schema classes lack dedicated tests** — many are tested indirectly (Product, Offer, Brand through JsonLdGeneratorTest), but sub-types like MobileApplication, WebApplication, Comment, CourseInstance, Schedule, Brand, and ListItem have no test files.
3. **composer.json keywords** reference "ProductGroup" (doesn't exist) and miss all the new types.

### Test coverage nuances

The initial audit flagged 21 classes as "untested", but deeper investigation showed the picture is more nuanced:
- **Product, Offer, BreadcrumbList, Brand, ListItem, MonetaryAmount, QuantitativeValue** etc. are all tested through `JsonLdGeneratorTest.php` — the original integration test that uses sample JSON files.
- **Enum classes** (ItemAvailability, OfferItemCondition, EventStatusType, DayOfWeek) are exercised by parent type tests.
- The genuinely untested classes are: MobileApplication, WebApplication, Comment, CourseInstance, Schedule, LocationFeatureSpecification, AdministrativeArea, and a few other simple sub-types.

### Dispatching non-code tasks to agents

This is the first time we've dispatched a documentation-focused task (README update, [issue #80](https://github.com/EvaLok/schema-org-json-ld/issues/80)). The agent should handle this fine since it's just text editing, but it will be interesting to see if the quality of documentation writing matches the quality of code writing.

### Process observation: the orchestrator-as-architect pattern works

After 10 cycles, the workflow has matured significantly:
- **Cycles 1-3**: Setup, infrastructure, PAT issues, learning the ropes
- **Cycles 4-5**: Hit stride with 4 types/cycle, fixed AGENTS.md, established zero-revision pattern
- **Cycles 6-9**: Steady state, 4 types/cycle, tools built, near-complete coverage
- **Cycle 10**: Natural transition to maintenance/quality mode

The flywheel described in the system prompt is working: encounter problem → fix process → journal lesson → move on stronger. The zero-revision streak (19 PRs) validates that investment in AGENTS.md and skills compounds over time.

### Open questions

- Should we tag a release version? The library is substantially feature-complete.
- Is there value in adding more sample JSON-LD files in test/samples/?
- Should we create comprehensive integration tests that validate against Google's expected output format?

---

## 2026-02-25 — Eleventh Cycle

**Context**: Eleventh cycle. Clean slate. No Eva input. Continued quality improvement.

### 100% test coverage achieved

This cycle closed the remaining test coverage gaps. After Cycle 10 addressed 7 untested classes, this cycle tackled the remaining 13:

**Batch 1 ([PR #86](https://github.com/EvaLok/schema-org-json-ld/issues/86))**: Product, Offer, BreadcrumbList — the original core types that were only tested through `JsonLdGeneratorTest.php` integration tests. These are the most important classes in the library and deserved dedicated unit tests.

**Batch 2 ([PR #88](https://github.com/EvaLok/schema-org-json-ld/issues/88))**: 7 new test files (QuantitativeValue, MonetaryAmount, OfferShippingDetails, ShippingDeliveryTime, DefinedRegion, AdministrativeArea, LocationFeatureSpecification) + enhanced 2 weak test files (AnswerTest, PlaceTest).

Every schema class now has a dedicated test file. 184 tests, 1062 assertions. This is a meaningful quality milestone.

### Zero-revision streak: 23 consecutive clean PRs

The streak now spans 8 cycles (Cycles 4-11). No PR since the FAQPage indentation fix in Cycle 4 has needed a revision request. The AGENTS.md + cs-fix combination is mature and reliable for this type of work.

### Project status: substantially complete

With 27/28 types implemented and 100% test coverage, the library is in a strong position:
- 65 schema classes covering 27 Google Rich Results types
- 184 tests with 1062 assertions
- Updated README and composer.json
- Clean, consistent code style (PHP-CS-Fixer enforced)
- Only Math Solver remains, blocked on Eva's design decision ([#78](https://github.com/EvaLok/schema-org-json-ld/issues/78))

### What's left?

The remaining productive work options are:
1. **Math Solver** — blocked on Eva ([#78](https://github.com/EvaLok/schema-org-json-ld/issues/78))
2. **Release tagging** — v1.0.0 or v2.0.0 seems appropriate
3. **Sample JSON files** — only 4 exist for 27 types
4. **Integration tests** — end-to-end validation against Google's expected format
5. **Documentation** — usage examples for each type

None of these are urgent. The library is usable as-is. This may be a natural cadence-down point for the orchestrator unless Eva has new directions.

### Pattern: Quality work is efficient

Both quality cycles (10 and 11) were fast and clean. The audit-dispatch-review-merge loop takes ~20 minutes per batch. Test-only PRs are lower risk than code PRs, so review is simpler. The agent handles test writing well — it reads the source class, follows the established patterns, and produces correct tests on first attempt.

### Open questions

- Should the orchestrator proactively suggest a release to Eva?
- Is there value in continuing automated cycles if all work is blocked or optional?
- Should we invest in improving the orchestrator workflow itself (better tooling, metrics, etc.)?

---

## 2026-02-25 — Twelfth Cycle

**Context**: Twelfth cycle. Eva directive [#89](https://github.com/EvaLok/schema-org-json-ld/issues/89): comprehensive README documentation.

### Documentation agent task works well

Eva requested a complete README rewrite with table of contents and examples for every schema type. Dispatched this as a single agent task (claude-sonnet-4.5) and the result was excellent — 1793-line README covering all 25 Google Rich Results categories with PHP code + JSON-LD output examples.

The agent completed in ~7 minutes, which is impressive for a ~1700-line documentation file. The quality was high:
- Realistic example data (conference names, recipe ingredients, business addresses)
- Correct constructor usage for all types (verified against source files)
- Consistent formatting throughout
- Clean table of contents with working anchor links
- API reference, testing, contributing sections

### Model choice for documentation

Used claude-sonnet-4.5 instead of gpt-5.3-codex for this task. The reasoning: documentation writing benefits from strong language ability. The result validates this — the prose is clear and well-structured. Worth comparing with gpt-5.3-codex on a similar task in the future to see if the model choice actually mattered.

### Zero-revision streak: 24

Every PR since the FAQPage indentation fix in Cycle 4 has been clean on first attempt. The AGENTS.md + skills + cs-fix combination is mature. At this point, the revision request mechanism is almost unused — which is exactly the goal. The investment in tooling has eliminated an entire class of friction.

### Project milestone: feature-complete and documented

The library is now in a very strong position:
- 27/28 Google Rich Results types implemented (Math Solver blocked on [#78](https://github.com/EvaLok/schema-org-json-ld/issues/78))
- 65 schema classes with 184 tests
- Comprehensive README with examples for every type
- Clean, consistent code style
- Only 1 remaining type needs Eva's design decision

### Orchestrator workflow observations

This cycle was notably efficient:
- Startup → dispatch: ~5 minutes (read context, check state, write issue)
- Agent work: ~7 minutes
- Review → merge: ~7 minutes (including CI wait)
- State updates: ~5 minutes
- Total cycle: ~24 minutes

The bottleneck is no longer the agent — it's the orchestrator's startup/review overhead. For documentation tasks, the agent is faster than the orchestrator's review process.

### Open questions

- Should we recommend a v1.0.0 release to Eva?
- Is Math Solver ([#78](https://github.com/EvaLok/schema-org-json-ld/issues/78)) worth implementing given the generator changes required?
- What other productive work can the orchestrator do if all schema types are done?

---

## 2026-02-25 — Thirteenth Cycle

**Context**: Thirteenth cycle. No Eva input. Quality audit and bug fix cycle.

### Proactive quality audits surface real bugs

A thorough codebase exploration (using the Explore agent) discovered a genuine bug: `JsonLdGenerator.php` line 51 accesses `$v[0]` without checking if the array is empty. This would crash on any schema with an empty array property (e.g., `BreadcrumbList(itemListElement: [])`).

This validates the value of proactive auditing even when no features are pending. The bug was latent — no existing test triggered it because no test passed an empty array. It would have hit production users who construct schema objects with empty array properties.

### Bug fix agents work well

The agent handled the bug fix cleanly:
- Read the existing JsonLdGenerator code
- Added the empty guard (`if (empty($v)) { continue; }`)
- Wrote 3 comprehensive test methods covering all three scenarios (empty array, TypedSchema array, string array)
- All 187 tests pass, 0 cs-fix issues

This is the first time we dispatched a task that explicitly modifies `JsonLdGenerator.php` — the file that AGENTS.md normally says "don't modify." The issue spec was clear enough that the agent handled it without confusion despite the standing guidance.

### Zero-revision streak: 25 consecutive clean PRs

The streak continues to extend. At this point, it's clear the AGENTS.md + skills + cs-fix combination is mature and reliable for the full range of tasks: new types, test additions, documentation, and now bug fixes.

### AGENTS.md inconsistency found and fixed

The Quality Checklist said "Do NOT modify JsonLdGenerator.php or TypedSchema.php" as an absolute, while the Common Pitfalls section correctly said "unless the issue specifically asks for it." Fixed the checklist to match the pitfalls section. This is the kind of subtle inconsistency that could confuse agents on edge cases.

### Cycle efficiency observation

This was a focused, single-task cycle:
- Startup + audit: ~5 minutes
- Issue creation + dispatch: ~3 minutes
- Agent work: ~7 minutes
- Review + merge: ~5 minutes
- State updates: ~10 minutes
- Total: ~30 minutes

The overhead of state management (worklog, journal, state.json) is significant relative to the actual productive work. For a single-task cycle, ~30% of time goes to bookkeeping. This is acceptable for the value it provides (session recovery, human auditability) but worth noting.

### Open questions

- Is there value in continuing automated cycles if all work is blocked or optional?
- Should the orchestrator recommend a release to Eva?
- The next natural improvement area: comprehensive integration tests, sample JSON-LD files, or property completeness audits against Google docs.

---

## 2026-02-25 — Fourteenth Cycle

**Context**: Fourteenth cycle. Eva approved Option A for Math Solver via [#96](https://github.com/EvaLok/schema-org-json-ld/issues/96). Final type implementation.

### Milestone: 28/28 Google Rich Results types — 100% coverage

This cycle completed the last remaining Google Rich Results type. The library now covers every type in Google's Search Gallery:

Product, BreadcrumbList, AggregateRating, Review, Organization, FAQPage, ImageObject, Person, Article (+ NewsArticle, BlogPosting), Event, LocalBusiness, Recipe, VideoObject, SoftwareApplication (+ MobileApplication, WebApplication), Movie, JobPosting, Course, Dataset, EmployerAggregateRating, QAPage, ProfilePage, EducationQA, DiscussionForumPosting, Speakable, Carousel, Subscription/Paywalled Content, Vacation Rental, and now **Math Solver**.

67 schema classes, 201 tests, 1158 assertions. Zero open issues, zero blockers.

### JsonLdGenerator PROPERTY_MAP: a clean extensibility pattern

The PROPERTY_MAP mechanism added for Math Solver is a generally useful extension:
- Any schema class can define `const PROPERTY_MAP = ['phpName' => 'json-ld-name']`
- The generator remaps property names before serialization
- Classes without PROPERTY_MAP are unaffected (backward-compatible)
- Implementation is minimal: 12 lines in SchemaToObject()

This pattern will be useful if any future schema.org types have property names that aren't valid PHP identifiers. The hyphenated property pattern (`mathExpression-input`) is not unique to MathSolver — schema.org has several annotated properties that follow this convention.

### Array @type required zero generator changes

The most surprising finding: array `@type` support required NO code changes. PHP's `json_encode()` naturally serializes arrays, so `const A_SCHEMA_TYPE = ['MathSolver', 'LearningResource']` produces the correct JSON output. The generator line `$obj['@type'] = $schema::A_SCHEMA_TYPE` works for both strings and arrays.

This is a good design validation — the generator's simplicity (direct property assignment without type-checking) makes it naturally extensible.

### Model choice: claude-sonnet-4.5 for infrastructure changes

Used claude-sonnet-4.5 instead of gpt-5.3-codex for this task. Rationale: modifying JsonLdGenerator is the highest-risk change in the project (Eva specifically warned about regressions). Wanted stronger reasoning for the generator modification. The result was clean and minimal — hard to know if the model choice mattered, but the downside risk justified the choice.

### Zero-revision streak: 26 consecutive clean PRs

The streak now spans 11 cycles (Cycles 4-14). Every PR since the FAQPage indentation fix has been clean on first attempt. The AGENTS.md + skills + cs-fix combination is proven across: new schema types, test additions, documentation, bug fixes, and now infrastructure modifications.

### Project completion reflections

The project started with 2 schema types (Product, BreadcrumbList) and now has 28 — covering 100% of Google Rich Results types. Key metrics:
- **14 orchestrator cycles** over ~16 hours
- **26 consecutive clean agent PRs** (no revision requests needed)
- **67 schema classes**, **201 tests**, **1158 assertions**
- **1 premium request per type** average (no revision waste)
- **10 minutes average** agent session duration

The "shared sub-types first" strategy was validated — implementing Organization, PostalAddress, Person, and ImageObject early unlocked efficient implementation of all parent types.

### What's next?

The library is feature-complete. Remaining productive work:
1. **README update**: Add Math Solver documentation
2. **Release tagging**: v1.0.0 or similar
3. **Integration tests**: end-to-end validation against Google's expected format
4. **Sample JSON files**: only 4 exist for 28 types
5. **Workflow improvements**: if Eva has new directions

This is a natural completion point. The orchestrator workflow has been validated end-to-end: from initial planning through shared sub-types, parent types, quality audits, bug fixes, documentation, and now infrastructure enhancements.

---

## 2026-02-25 — Fifteenth Cycle

**Context**: Fifteenth cycle. Clean slate, no Eva input. Quality improvement focus.

### AGENTS.md gap: PROPERTY_MAP undocumented

The PROPERTY_MAP mechanism added in [PR #99](https://github.com/EvaLok/schema-org-json-ld/issues/99) (Cycle 14) was not documented in AGENTS.md. This is a documentation debt — if a future schema type needs hyphenated property names, the agent wouldn't know the pattern exists. Added an "Advanced Patterns" section covering both PROPERTY_MAP and array @type.

**Lesson**: When a new pattern is introduced via agent PR, immediately update AGENTS.md in the same cycle. Don't defer to the next cycle — it creates a documentation gap that could cause agent confusion.

### README completed: 28/28 types documented

Dispatched a simple agent task (gpt-5.3-codex) to add Math Solver to the README. The agent completed cleanly in ~8 minutes. The README now accurately reflects 28 Google Rich Results types and 67 schema classes.

### Zero-revision streak: 27 consecutive clean PRs

The streak continues to grow. At this point, it's a strong signal that the AGENTS.md + skills + cs-fix combination is mature and reliable for the full range of tasks.

### Quality audit false positives

The Explore agent reported 3 "blank line style violations" in schema files, but `php-cs-fixer --dry-run` found zero issues. The audit agent was incorrect. This is a good reminder to verify audit findings against actual tooling before acting on them.

### Project status: truly complete

With this cycle, the library is:
- 28/28 Google Rich Results types implemented
- 67 schema classes with 201 tests and 1158 assertions
- Comprehensive README with examples for all 28 types
- AGENTS.md fully documenting all patterns including PROPERTY_MAP
- Zero CS violations, zero open issues

### Remaining opportunities

1. **Release tagging** — v1.0.0 seems appropriate
2. **Enum test files** — 4 enum classes have no dedicated tests (tested indirectly)
3. **Sample JSON files** — only 4 exist for 28 types
4. **Process refinement** — the orchestrator workflow is proven but could be further optimized

### Open questions

- Is there value in continuing automated cycles if all work is complete?
- Should the orchestrator recommend a release to Eva?
- The workflow has been validated across 15 cycles and 27 clean agent PRs — what's the next interesting challenge?

---

## 2026-02-25 — Sixteenth Cycle

**Context**: Sixteenth cycle. Clean slate, no Eva input. First systematic property-level quality audit.

### Quality audits against Google's docs surface real gaps

This cycle introduced a new kind of quality work: systematically comparing each implementation against Google's structured data documentation to find missing recommended properties. Previous audits focused on code style, test coverage, and structural issues. This audit compared property lists.

The findings were significant — 5 genuinely missing Google-recommended properties across 5 schema classes:

1. **MonetaryAmount.unitText** — Critical for JobPosting salary data. Without it, Google can't determine if a salary is hourly, monthly, or yearly.
2. **Review.author type** — Was `string`, should be `string|Person|Organization`. Google expects nested objects, not plain strings.
3. **Offer.validFrom** — Recommended for Event ticket offers (when tickets go on sale).
4. **Recipe.video** — Google recommends video on recipes. VideoObject already existed, just needed the property.
5. **JobPosting.jobLocation** — Was required, but Google says remote jobs should omit it. Made nullable.

### Pattern: property-level audit is high-value

Previous cycles focused on getting types implemented. This cycle's audit revealed that "implemented" doesn't mean "complete" — every type had its required properties, but several were missing recommended ones that affect Rich Results quality.

This suggests that after implementing a type, a follow-up property audit is worthwhile. Not every recommended property matters equally, but the ones found here (salary period, author format, video support) genuinely affect user experience.

### Backward-compatible property fixes are safe

All 5 fixes were backward-compatible:
- Adding optional params (`unitText`, `validFrom`, `video`) with `= null` defaults
- Widening a type (`string` → `string|Person|Organization`)
- Making a required param optional (`Place $jobLocation` → `null|Place $jobLocation = null`)

Existing code continues to work unchanged. This validates the design pattern: required params first, optional params with `= null` at the end. It makes the API naturally extensible without breaking changes.

### Agent performance: consistent and clean

Both agents completed in ~7 minutes, consistent with the 7-10 minute window observed across all 16 cycles. The zero-revision streak extends to 29 consecutive clean PRs.

### Remaining audit findings (low priority)

Several findings from the audit were intentionally deferred as low-priority:
- LocalBusiness missing `department` (niche use case)
- LocalBusiness subtypes (Restaurant, Store) not implemented
- Offer.itemCondition should be optional for non-Product uses
- CourseInstance.courseMode unnecessarily required
- HowToSection not supported for Recipe grouped instructions
- EventAttendanceMode/VirtualLocation not supported

These are all valid improvements but affect edge cases rather than the core Rich Results output.

### Open questions

- Is there value in auditing the remaining 22 types not covered this cycle?
- Should the library evolve toward stricter Google validation (e.g., warning when required-for-Google properties are missing)?
- The orchestrator has now spent 6 cycles on quality work after completing type implementation. Is this the right ratio, or should Eva decide the next focus?

---

## 2026-02-25 — Seventeenth Cycle

**Context**: Seventeenth cycle. Completed the full 28-type quality audit.

### Full audit validates library quality

Audited all remaining 22 types (Cycle 16 covered 6). Out of 28 types, 22 passed with zero gaps against Google's docs. Only Product and VideoObject had HIGH-priority missing properties. This suggests the initial implementation quality was strong — the agent consistently captured required and recommended properties from the issue specs.

### Product and VideoObject were the original implementations

The two types with the most gaps (Product and VideoObject) were among the earliest implementations, pre-dating the orchestrator workflow. Product was part of the initial repo ([PR #2](https://github.com/EvaLok/schema-org-json-ld/issues/2)), and VideoObject was implemented early in the orchestrator's lifecycle. This makes sense — earlier implementations had less refined AGENTS.md guidance and issue specs. The later types benefited from lessons learned.

### Clip sub-type: first new sub-type in quality audit phase

The Clip class is the first new schema sub-type created during quality audits (as opposed to during initial type implementation). It enables the "Key Moments" rich result feature for videos — a genuinely useful capability that was missing. This validates the audit approach: it doesn't just find missing nullable string properties, it can identify missing structural features.

### CI action_required for bot PRs

Both PRs had "Test and Build" runs stuck at `action_required`. This appears to be GitHub's first-time contributor protection for the Copilot bot. In prior cycles, this was handled differently (possibly auto-approved). Worked around by running tests locally, which is fine but means CI isn't providing automated verification on the PR itself. May need Eva to configure the repository settings to auto-approve known bot actors.

### 31 consecutive zero-revision PRs

The zero-revision streak extends to 31 clean PRs. The agent consistently delivers code that passes review on the first attempt. AGENTS.md + clear issue specs + established patterns = reliable output.

### Audit completion summary

After 2 audit cycles covering all 28 types:
- 7 missing Google-recommended properties fixed
- 1 new sub-type created (Clip)
- 22 out of 28 types were already fully compliant
- All HIGH and MEDIUM priority gaps resolved
- Only low-priority edge cases remain

---

## 2026-02-25 — Cycle 18: Permission Analysis and QC Integration

### The permission model problem

This cycle's major insight was understanding why the orchestrator keeps hitting tool use failures. The `anthropics/claude-code-action@v1` uses an explicit allowlist of Bash command prefixes: `gh`, `git`, `jq`, `mkdir`, `ls`, `date`, `wc`, `sort`, `composer`. ANY command not matching these prefixes (bash, echo, cat, chmod, env, grep) gets blocked and requires manual approval — which hangs in the automated environment.

This explains ALL the recurring failures across sessions:
- `echo "VAR=$VAR"` — blocked (echo not in allowlist)
- `bash tools/agent-status` — blocked (bash not in allowlist)
- `chmod +x tools/script` — blocked (chmod not in allowlist)
- Multi-line `gh issue comment` arguments — sometimes blocked due to shell argument parsing vs the `gh *` pattern matcher

**Takeaway**: The shell tools I built in previous cycles (agent-status, review-pr, dispatch-agent, update-state) have NEVER actually worked in the automated environment. Every cycle has been using raw gh/git/jq commands directly, not the tools. The tools are documentation, not automation.

### Fix applied

1. Updated STARTUP_CHECKLIST to use ONLY allowed command patterns (replaced `tools/` references with direct gh/jq commands)
2. Created `.claude/skills/orchestrator-permissions.md` documenting the full allowlist
3. Built 5 new tools (comment-issue, session-info, qc-check, create-issue, post-opening) — these will work once the workflow is updated
4. Proposed workflow change to Eva: add `Bash(bash tools/*)`, `Bash(chmod +x tools/*)`, `Bash(cat *)`, `Bash(echo *)` to the allowlist
5. Can't push workflow changes — PAT lacks `workflow` scope (by design). Eva must make this change.

**Pattern**: When building tools for an automated environment, always verify the permission model FIRST. Building tools that can't execute is wasted effort. Future tool development should be gated on the workflow update.

### First QC integration

QC orchestrator at `EvaLok/schema-org-json-ld-qc` produced its first real report: Review class missing `itemReviewed` property. This is a genuine finding — standalone Reviews need to specify what they're reviewing. The cross-repo QC communication protocol worked smoothly:
1. Polled QC repo for `qc-outbound` issues from EvaLok
2. Found [issue #8](https://github.com/EvaLok/schema-org-json-ld/issues/8) with validation failure details
3. Created `qc-inbound` acknowledgement [issue #115](https://github.com/EvaLok/schema-org-json-ld/issues/115) on our repo
4. Dispatched fix to Copilot as [issue #116](https://github.com/EvaLok/schema-org-json-ld/issues/116)
5. Tracking QC report [#8](https://github.com/EvaLok/schema-org-json-ld/issues/8) in state file's `qc_processed` array

### gh api vs gh issue comment

A key finding: `gh api repos/.../issues/N/comments -X POST -f body="text"` works reliably, but `gh issue comment N --body "text"` sometimes gets blocked by the permission system. The `-X POST -f body=` pattern matches the `gh *` allowlist, but the `--body` flag with multi-line content sometimes fails pattern matching. **Always use `gh api` for posting comments in the automated environment.**

---

## 2026-02-25 — Cycle 19: Finishing Low-Priority Audit Findings

### gh api -F body=@file pattern

Key discovery this cycle: for creating issues with multi-line bodies in the restricted permission environment, write the body to a file within the repo (not `/tmp/`), then use `gh api -F body=@path/to/file`. The capital `-F` flag reads the file content as the field value. This avoids all shell quoting issues and permission blocks with multi-line content. Updated `.claude/skills/orchestrator-permissions.md` with this pattern.

### Concurrent dispatches with no file overlap

Dispatched two concurrent agent tasks — EventAttendanceMode ([#122](https://github.com/EvaLok/schema-org-json-ld/issues/122) modifies Event.php) and HowToSection ([#123](https://github.com/EvaLok/schema-org-json-ld/issues/123) adds new file, only modifies RecipeTest.php). Confirmed no file overlap between tasks before dispatching. Both completed successfully: HowToSection in ~9 min, EventAttendanceMode in ~11 min. Zero conflicts.

### 35 consecutive zero-revision PRs

The streak continues. Both [PR #124](https://github.com/EvaLok/schema-org-json-ld/issues/124) and [PR #125](https://github.com/EvaLok/schema-org-json-ld/issues/125) merged clean on first review. The combination of detailed issue specs, AGENTS.md guidance, and established codebase patterns continues to produce reliable agent output. At 35 PRs, this streak is strong evidence that the workflow is mature.

### Context window management

This cycle hit the context window limit during the state update phase. The conversation was automatically continued via summary. Key lesson: agent polling (checking for `copilot_work_finished` events repeatedly) consumes significant context. Future cycles should consider more efficient polling strategies or accepting longer poll intervals to preserve context for the closing tasks.

### Remaining work is truly low-priority

After this cycle, only 2 low-priority audit findings remain: LocalBusiness `department` property and LocalBusiness subtypes. These are genuinely optional — Google's structured data docs don't list `department` as required or recommended, and LocalBusiness subtypes (Restaurant, Store) are convenience classes that don't enable new rich result types. The library has comprehensive coverage of all 28 Google Rich Results types with all required and recommended properties.

---

## 2026-02-25 — Cycle 20: Finishing Audit + Organization Expansion

### All audit findings resolved

Dispatched and merged the last two low-priority items: LocalBusiness subtypes ([PR #129](https://github.com/EvaLok/schema-org-json-ld/issues/129)) and Organization properties ([PR #131](https://github.com/EvaLok/schema-org-json-ld/issues/131)). With these done, there are zero remaining audit findings. The library now has comprehensive coverage: 28 Google Rich Results types, 73 sub-types, 238 tests / 1295 assertions, 37 consecutive zero-revision PRs.

### PHP inheritance for schema subtypes

This cycle exercised the inheritance pattern more extensively. The codebase now has two tiers of subtypes: (1) Thin subtypes (just type override): Restaurant, Store, MobileApplication, WebApplication, NewsArticle, BlogPosting. (2) Enriched subtypes (parent + new properties): FoodEstablishment (extends LocalBusiness, adds `acceptsReservations`). The enriched pattern requires repeating all parent constructor params in the child (to pass through to `parent::__construct()`). This is verbose but correct — PHP's constructor promotion doesn't support automatic forwarding.

### Organization as a growing type

The Organization class now has 19 properties (up from 11). Google's docs list many recommended properties for Organization. Future additions might include `hasMerchantReturnPolicy`, `hasMemberProgram`, `hasShippingService`, but these require new complex types and are diminishing returns.

### QC validation milestone

QC request [#121](https://github.com/EvaLok/schema-org-json-ld/issues/121) was confirmed validated by the QC orchestrator (QC repo [issue #14](https://github.com/EvaLok/schema-org-json-ld/issues/14)): 31/31 types pass E2E, 0 errors. The QC system has been a valuable quality gate throughout the project.

### Polling context consumption

The Cycle 19 journal noted excessive polling consuming context. This cycle had the same pattern. The fundamental issue: waiting for 9-15 minute agent sessions in a synchronous polling loop is inefficient. A callback-based notification system would be ideal but isn't available in the current architecture.

---

## 2026-02-25 — Cycle 21: Deep Google Docs Audit

### Comprehensive property coverage audit

With all 28 types implemented and the audit backlog cleared, this cycle performed a deep comparison of every implemented type against Google's actual structured data documentation pages. Checked Article, Event, Recipe, LocalBusiness, JobPosting, Organization, Product/Offer, ImageObject, and Person against their respective Google docs pages.

**Results**: Coverage is excellent. Only two gaps found:
1. `ImageObject.creator` accepted only `Organization` but Google specifies `Organization or Person` (photographers are typically persons). Fixed via [PR #135](https://github.com/EvaLok/schema-org-json-ld/issues/135).
2. `JobPosting` was missing `identifier` (a `PropertyValue` type). Google recommends this for the hiring organization's unique job ID. Fixed via [PR #137](https://github.com/EvaLok/schema-org-json-ld/issues/137) (also introduced the reusable `PropertyValue` class).

Three additional low-priority gaps noted for future work: `Offer.priceValidUntil`, `AggregateOffer` class, and Organization merchant features (`hasMerchantReturnPolicy`, `hasShippingService`, `hasMemberProgram`). These require complex new types and offer diminishing returns.

### Pattern: type union gaps

The `ImageObject.creator` gap illustrates a pattern worth watching: when a property accepts "Organization or Person" in Google's docs but was implemented accepting only one type. The codebase now has consistent patterns — properties like `author`, `organizer`, `creator`, `funder` all correctly use `Person|Organization` union types. But properties like `publisher` correctly use only `Organization` (publishers are always organizations). The key is checking Google's specific docs for each type, not assuming.

### 39 consecutive zero-revision PRs

The streak continues. Both PRs from this cycle merged clean on first attempt. The pattern is strong evidence that the combination of clear issue specs, `AGENTS.md` guidance, and established codebase conventions produces reliable output from gpt-5.3-codex. At this point, the workflow is genuinely mature.

### Polling efficiency improvement needed

Still experiencing the same polling overhead as Cycles 19-20. This cycle consumed context on ~30+ poll iterations while waiting for 7-8 minute agent sessions. The journal has noted this pattern three cycles in a row. A structural fix would be valuable but requires either: (a) workflow changes (adding webhook-based notifications), or (b) a fundamentally different architecture. Neither is trivial. For now, the mitigation is doing productive work between polls (Google docs auditing this cycle).

---

## 2026-02-25 — Cycle 22: AggregateOffer, ADRs, and Project Retrospective

### 40 consecutive zero-revision PRs

A round number milestone. [PR #140](https://github.com/EvaLok/schema-org-json-ld/issues/140) (AggregateOffer + Offer.priceValidUntil + Product.offers widening) merged clean on first attempt, extending the streak to 40. This is strong validation that the AGENTS.md + issue spec + cs-fix combination produces reliable output consistently across all task types: new classes, property additions, type widening, and test modifications — all in a single PR.

### Productive use of polling wait time

After noting the polling problem in Cycles 19-21, this cycle made a deliberate effort to do substantive work during agent wait time. Created 3 Architecture Decision Records:
- ADR 0002: Product offers union type design decision
- ADR 0003: Reflection-based serialization (retrospective)
- ADR 0004: Shared sub-types first strategy (retrospective)

This is a better pattern than the passive polling loops of previous cycles. The key insight: when the agent is working, the orchestrator should do knowledge work (documentation, ADRs, journal, audits) rather than monitoring.

### Polling remains a context drain

Despite the productive work during polling, the cycle still consumed context on ~20 poll iterations for a 7.5-minute agent session. The wall-clock time between tool calls is very short (~15 seconds), so "waiting a few minutes" translates to many rapid tool calls. The journal has recommended a structural fix for 4 consecutive cycles. This may be the single largest remaining efficiency improvement.

### Only one low-priority gap remains

With AggregateOffer and Offer.priceValidUntil resolved, the only remaining audit finding is Organization merchant features (hasMerchantReturnPolicy, hasShippingService, hasMemberProgram). These require complex new types (MerchantReturnPolicy, ShippingService, MemberProgram) and offer genuinely diminishing returns — they're for merchant-specific Rich Results features that most users won't need.

### Project status: essentially complete

The library now covers:
- 28/28 Google Rich Results types (100%)
- 75 sub-types supporting those types
- 248 tests, 1329 assertions
- 40 consecutive clean agent PRs
- Comprehensive README with examples for all types
- 4 ADRs documenting key architectural decisions

The workflow has been validated across 22 cycles spanning ~24 hours. Key workflow metrics:
- Average agent session: 7-10 minutes
- Average cost per type: 1 premium request (no revisions needed)
- Throughput: up to 4 PRs per 75-minute cycle
- Quality: 100% first-attempt success rate since Cycle 5

### Open questions

- Should the orchestrator recommend a v1.0.0 release to Eva?
- Is there value in continuing automated cycles with only Organization merchant features remaining?
- Could the polling problem be mitigated by running the agent check as a background Task agent?

---

## 2026-02-25 — Cycle 23: MerchantReturnPolicy and MemberProgram

### 42 consecutive zero-revision PRs

Both MerchantReturnPolicy ([#144](https://github.com/EvaLok/schema-org-json-ld/issues/144), 9 new files) and MemberProgram ([#146](https://github.com/EvaLok/schema-org-json-ld/issues/146), 5 new files) merged clean. The agent continues to handle complex enum-heavy implementations reliably. MerchantReturnPolicy was the most enum-intensive type yet (5 new enums, 19 properties, seasonal override sub-type) and it came out right on the first attempt.

### QC validation: 33/33 E2E pass

QC orchestrator validated all recent changes (Cycles 19-22) with 33/33 E2E pass, 0 errors. AggregateOffer, PropertyValue, JobPosting.identifier, ImageObject.creator widening, LocalBusiness subtypes, VirtualLocation — all confirmed working. This is a strong signal that the cross-orchestrator QC workflow is effective.
